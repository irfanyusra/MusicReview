<!-- TODO: add header and html tag stuff for all the html files -->
<!-- TODO: validation for all forms  -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Secure</title>
</head>

<header>
  <div class="container">
    <a routerLink="/" class="logo">3316 Lab 5</a>

    <nav>
      <ul>
        <li><a routerLink="/" class="logo">Logout</a></li>
      </ul>
    </nav>
  </div>
</header>

<div class="container">
  <h2>Top 10 Most Popular Songs</h2>
  <div *ngFor="let s of songs; index as i">
    <h4>
      {{ i + 1 }}. {{ s.title }}
      <button
        (click)="this.s.expand = !this.s.expand"
        (click)="most_recent_review(s._id)"
      >
        <span *ngIf="!this.s.expand; then thenBlock; else elseBlock"></span>
        <ng-template #thenBlock>v </ng-template>

        <ng-template #elseBlock> ^</ng-template>
      </button>
    </h4>

    <div *ngIf="this.s.expand">
      <h5>
        Artist:
        <span>{{ s.artist }}</span>
        <br />
        Album:
        <span>{{ s.album }}</span>
        <br />
        Year:
        <span>{{ s.year }}</span>
        <br />
        Number Of Ratings:
        <span>{{ s.noOfReviews }}</span>
        <br />
        Average Rating:
        <span>{{ s.avgOfRatings }}</span>
        <br />
        Most Recent Review:
        <br />
        <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>Subject:
        <span> {{ this.recent_review.subject }}</span> <br /><span
          >&nbsp;&nbsp;&nbsp;&nbsp;</span
        >
        Comment: <span> {{ this.recent_review.comment }}</span> <br /><span
          >&nbsp;&nbsp;&nbsp;&nbsp;</span
        >
        Rating: <span> {{ this.recent_review.rating }}</span> <br /><span
          >&nbsp;&nbsp;&nbsp;&nbsp;</span
        >
        SubmittedBy: <span> {{ this.recent_review.submittedBy }}</span>
        <br /><span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
        Submitted On:
        <span> {{ this.recent_review.submittedOn }}</span>
        <br />

        <button
          (click)="this.s.rev_expand = !this.s.rev_expand"
          (click)="all_reviews(s._id)"
        >
          <span
            *ngIf="!this.s.rev_expand; then thenBlock; else elseBlock"
          ></span>
          <ng-template #thenBlock>More Reviews</ng-template>

          <ng-template #elseBlock>Less Reviews</ng-template>
        </button>
        <div *ngIf="this.s.rev_expand">
          <div *ngFor="let r of reviews; index as i">
            Review:
            <br />
            <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
            Subject:
            <span> {{ r.subject }}</span> <br /><span
              >&nbsp;&nbsp;&nbsp;&nbsp;</span
            >
            Comment: <span> {{ r.comment }}</span> <br /><span
              >&nbsp;&nbsp;&nbsp;&nbsp;</span
            >
            Rating: <span> {{ r.rating }}</span> <br /><span
              >&nbsp;&nbsp;&nbsp;&nbsp;</span
            >
            SubmittedBy: <span> {{ r.submittedBy }}</span> <br /><span
              >&nbsp;&nbsp;&nbsp;&nbsp;</span
            >
            Submitted On:
            <span> {{ r.submittedOn }}</span>
          </div>
        </div>
      </h5>
    </div>
  </div>
</div>

<div class="container">
  <h2>
    Add a Review to a song
  </h2>
  <form name="add-review-form" novalidate (ngSubmit)="submit_review()">
    Subject:
    <input name="subject" type="text" [(ngModel)]="new_review.subject" />
    <br />
    Rating:
    <input name="rating" type="number" [(ngModel)]="new_review.rating" />
    <br />
    Comment:
    <input name="comment" type="text" [(ngModel)]="new_review.comment" />
    <br />
    Song:
    <select name="songId" [(ngModel)]="new_review.songId">
      <option>Song to add review</option>
      <option value="{{ song._id }}" *ngFor="let song of songs"
        >{{ song.title }} - {{ song.artist }}</option
      >
    </select>
    <input type="submit" />
    <br />
    {{ add_review_output }}
  </form>
  <br />
</div>

<div class="container">
  <h2>
    Add a song
  </h2>
  <form name="add-song-form" novalidate (ngSubmit)="add_new_song()">
    Title:
    <input name="title" type="text" [(ngModel)]="new_song.title" />
    <br />
    Artist:
    <input name="artist" type="text" [(ngModel)]="new_song.artist" />
    <br />
    Album:
    <input name="album" type="text" [(ngModel)]="new_song.album" />
    <br />
    Year:
    <input name="year" type="text" [(ngModel)]="new_song.year" />
    <br />
    Genre:
    <input name="genre" type="text" [(ngModel)]="new_song.genre" />
    <br />
    Comment:
    <input name="comment" type="text" [(ngModel)]="new_song.comment" />
    <br />
    <br />

     <a 
          (click)="this.song_rev_expand = !this.song_rev_expand"
          (click)="add_song_rev = !add_song_rev"
        >
          <span
            *ngIf="!this.song_rev_expand; then thenBlock; else elseBlock"
          ></span>
          <ng-template #thenBlock>Add Review</ng-template>

          <ng-template #elseBlock>Cancel Review</ng-template>
  </a>
    <div *ngIf="this.song_rev_expand">
      <h5>
        Review:
        <br />
        Subject:
        <input name="subject" type="text" [(ngModel)]="new_review.subject" />
        <br />
        Rating:
        <input name="rating" type="number" [(ngModel)]="new_review.rating" />
        <br />
        Comment:
        <input name="comment" type="text" [(ngModel)]="new_review.comment" />
      </h5>
    </div>
    <br>
    <input type="submit" />
    <br />
    {{ add_song_output }}
  </form>

  <!-- TODO: add option to add review  -->
  <br />
</div>
